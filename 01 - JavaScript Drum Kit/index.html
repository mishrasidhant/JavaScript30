<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JS Drum Kit</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>


  <div class="keys">
    <div data-key="65" class="key">
      <kbd>A</kbd>
      <span class="sound">clap</span>
    </div>
    <div data-key="83" class="key">
      <kbd>S</kbd>
      <span class="sound">hihat</span>
    </div>
    <div data-key="68" class="key">
      <kbd>D</kbd>
      <span class="sound">kick</span>
    </div>
    <div data-key="70" class="key">
      <kbd>F</kbd>
      <span class="sound">openhat</span>
    </div>
    <div data-key="71" class="key">
      <kbd>G</kbd>
      <span class="sound">boom</span>
    </div>
    <div data-key="72" class="key">
      <kbd>H</kbd>
      <span class="sound">ride</span>
    </div>
    <div data-key="74" class="key">
      <kbd>J</kbd>
      <span class="sound">snare</span>
    </div>
    <div data-key="75" class="key">
      <kbd>K</kbd>
      <span class="sound">tom</span>
    </div>
    <div data-key="76" class="key">
      <kbd>L</kbd>
      <span class="sound">tink</span>
    </div>
  </div>

  <audio data-key="65" src="sounds/asholomio.wav"></audio>
  <audio data-key="83" src="sounds/hihat.wav"></audio>
  <audio data-key="68" src="sounds/kick.wav"></audio>
  <audio data-key="70" src="sounds/openhat.wav"></audio>
  <audio data-key="71" src="sounds/aallrighty.wav"></audio>
  <audio data-key="72" src="sounds/ride.wav"></audio>
  <audio data-key="74" src="sounds/snare.wav"></audio>
  <audio data-key="75" src="sounds/tom.wav"></audio>
  <audio data-key="76" src="sounds/yessatan.wav"></audio>

<script>
  /**** TASKS ****
  1. When Key is pressed, visually indicate the keypress
  2. When the key is pressed play an associated sound
  */

  /** Functions **/
  function playSound(e) {
    if (!e.keyCode) return
    const audioElement = document.querySelector(`audio[data-key="${e.keyCode}"]`)
    const keyElement = document.querySelector(`div[data-key="${e.keyCode}"]`)
    if (!audioElement) return;
    /*  By adding the class of playing, we've allowed for the button to
    change appearance on the front end (via the css class), To reset that
    appearance, the class must be removed. You can't do that directly (ie
    keyElement.classList.remove('playing') b/c then the transtition isn't
    visible at all, due to the speed with which this function executes.
    You can do a setTimeout and pass in the time after which you should remove
    the class, but then you've got to keep track of the time passed through in
    this function, as well as the time in the css transition attribute.
    One possible solution woudl be to add a 'transition end event' that fires
    at the end of the animation.
    */
    keyElement.classList.add('playing');
    // This handles repeated triggers on the same key by resetting to the
    audioElement.currentTime = 0;
    audioElement.play();
  };


  /**
  'this' will always be the object (or thing) that the function has been called
  against, so in this case it's key b/c addEventListner has the callback of
  removeTrnsition, and addEventListener is called against key
  (key.addEventListener( 'transitionend', removeTrnsition));
  */
  function removeTransition(e){
    if (e.propertyName !== 'transform') return;
    // && this.classList.value.contains('playing') This didn't work..
    if (this && this.classList){
      this.classList.remove('playing');
    }
  }

  /** REGISTERING EVENT LISTENERS **/

  window.addEventListener('keydown', playSound);
  /* "querySelector" and "querySelectorAll" takes a CSS selector as the parameter
     .name will search for a 'class' of name eg class="key" in this case
     #name will search for a 'id' of name
     . maps to class
     # maps to id
     div.note will map to div of class note
     p maps to <p> element
  */
  const keys = document.querySelectorAll('.key');
  keys.forEach( key => {
    key.addEventListener('transitionend', removeTransition);
  });

</script>


</body>
</html>
